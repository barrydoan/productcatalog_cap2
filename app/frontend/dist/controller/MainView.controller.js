sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","frontend/model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/ui/Device","sap/ui/model/Sorter","sap/ui/model/odata/v4/ODataModel","sap/base/util/UriParameters","sap/ui/core/routing/HashChanger"],function(e,t,o,i,a,n,r,s,l,g,d){"use strict";return e.extend("frontend.controller.MainView",{formatter:o,onInit:function(){this.onBaseInit();this._mViewSettingsDialogs={};var e,o,a=this.byId("table");o=a.getBusyIndicatorDelay();this._aTableSearchState=[];e=new t({worklistTableTitle:this.getResourceBundle().getText("worklistTableTitle"),shareOnJamTitle:this.getResourceBundle().getText("worklistTitle"),shareSendEmailSubject:this.getResourceBundle().getText("shareSendEmailWorklistSubject"),shareSendEmailMessage:this.getResourceBundle().getText("shareSendEmailWorklistMessage",[location.href]),tableNoDataText:this.getResourceBundle().getText("tableNoDataText"),tableBusyDelay:0});this.setModel(e,"worklistView");a.attachEventOnce("updateFinished",function(){e.setProperty("/tableBusyDelay",o)});var n=window.location.origin;console.log("origin",n);this._oDataModel=new l({groupId:"$direct",synchronizationMode:"None",serviceUrl:"cart/"});console.log("oDataModel",this._oDataModel);var r=d.getInstance();var s=this;r.attachEvent("hashChanged",function(e){console.log("Hash changed");var t=g.fromQuery(window.location.hash.replace("#/","")).get("category");if(t){var o=s.byId("table").getBinding("items");var a=new i("categoryName","EQ",t);o.filter([a]);s.byId("oComboBoxCategory").setValue(t);window.location.hash=""}})},onUpdateFinished:function(e){console.log("onUpdateFinished");var t,o=e.getSource(),i=e.getParameter("total");if(i&&o.getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("worklistTableTitleCount",[i])}else{t=this.getResourceBundle().getText("worklistTableTitle")}this.getModel("worklistView").setProperty("/worklistTableTitle",t)},onPress:function(e){console.log("Item clicked");this._showObject(e.getSource())},onNavBack:function(){history.go(-1)},onSearch:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh()}else{var t=[];var o=e.getParameter("query");if(o&&o.length>0){t=[new i("name",a.Contains,o)]}this._applySearch(t)}},onRefresh:function(){var e=this.byId("table");e.getBinding("items").refresh()},_showObject:function(e){this.getRouter().navTo("object",{objectId:e.getBindingContext().getProperty("ProductID")})},_applySearch:function(e){var t=this.byId("table"),o=this.getModel("worklistView");t.getBinding("items").filter(e,"Application");if(e.length!==0){o.setProperty("/tableNoDataText",this.getResourceBundle().getText("worklistNoDataWithSearchText"))}},getViewSettingsDialog:function(e){var t=this._mViewSettingsDialogs[e];if(!t){t=n.load({id:this.getView().getId(),name:e,controller:this}).then(function(e){if(r.system.desktop){e.addStyleClass("sapUiSizeCompact")}return e});this._mViewSettingsDialogs[e]=t}return t},handleSortButtonPressed:function(){this.getViewSettingsDialog("frontend.view.SortDialog").then(function(e){e.open()})},handleSortDialogConfirm:function(e){var t=this.byId("table"),o=e.getParameters(),i=t.getBinding("items"),a,n,r=[];a=o.sortItem.getKey();n=o.sortDescending;r.push(new s(a,n));i.sort(r)},onCategoryChange:function(e){var t=this.byId("oComboBoxCategory").getValue(),o=this.byId("table").getBinding("items"),a;if(t){a=new i("categoryName","EQ",t);o.filter([a])}else if(t===""){o.filter([])}},onSupplierChange:function(e){var t=this.byId("oComboBoxSupplier").getValue(),o=this.byId("table").getBinding("items"),a;if(t){a=new i("supplierName","EQ",t);o.filter([a])}else if(t===""){o.filter([])}},onAddToCart:function(e){console.log(e);var t=e.getSource();console.log(t.oParent);var o=jQuery.sap.byId(t.oParent.sId).find("[name='productId']").val();var i=jQuery.sap.byId(t.oParent.sId).find("[name='productQuantity']").val();console.log(o);console.log(i);console.log(jQuery.sap);var a=this.getModel("baseModel");var n=a.oData.cartInfo;var r={parent_ID:n.ID,product_ID:parseInt(o)};console.log("data",r);if(n.ID==""){alert("Please select cart")}else{jQuery.ajax(this.getBaseUrl()+"/cart/CartItems",{data:JSON.stringify(r),contentType:"application/json",type:"POST"})}},showProductDetail:function(e){var t=e.getSource();var o=t.getBindingContext();var i=o.getProperty("ID");console.log("id",i);this.getRouter().navTo("RouteProductDetailView",{productId:i})}})});