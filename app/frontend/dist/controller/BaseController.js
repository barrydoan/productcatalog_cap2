sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/UIComponent","sap/m/library","sap/ui/core/Fragment","sap/ui/model/json/JSONModel"],function(e,t,o,a,n,i,l){"use strict";return e.extend("frontend.controller.BaseController",{getRouter:function(){return t.getRouterFor(this)},getModel:function(e){return this.getView().getModel(e)},setModel:function(e,t){return this.getView().setModel(e,t)},getResourceBundle:function(){return this.getOwnerComponent().getModel("i18n").getResourceBundle()},onBaseInit:function(){this._pDialog=null;console.log("dialog",this._pDialog);this._oStorage=jQuery.sap.storage(jQuery.sap.storage.Type.local);var e=this;var t=this._oStorage.get("baseModel");console.log("cartInforVlaue",t);if(t){var o=JSON.parse(t);jQuery.ajax(e.getBaseUrl()+"/cart/Carts("+o.ID+")",{contentType:"application/json",type:"GET",success:function(){var t=new n({cartInfo:o});e.setModel(t,"baseModel")}})}else{var a=new n({cartInfo:{ID:"",cardNo:"Select cart",total:""}});this.setModel(a,"baseModel")}console.log("onInit work")},getBaseUrl:function(){var e=window.location.href;e=e.substring(0,e.indexOf("/index.html"));var t=window.location.origin;return t},onAfterRendering:function(){const e="JTdCJTIyZXhwYW5kZXJMb2dvJTIyJTNBJTIyaHR0cHMlM0ElMkYlMkZjZG4uY2FpLnRvb2xzLnNhcCUyRndlYmNoYXQlMkZ3ZWJjaGF0LWxvZ28uc3ZnJTIyJTJDJTIyZXhwYW5kZXJUaXRsZSUyMiUzQSUyMkNsaWNrJTIwb24lMjBtZSElMjIlMkMlMjJvbmJvYXJkaW5nTWVzc2FnZSUyMiUzQSUyMkNoYXQlMjB3aXRoJTIwbWUhJTIyJTJDJTIydGhlbWUlMjIlM0ElMjJERUZBVUxUJTIyJTdE";const t="5eed170f-fa43-4098-a9af-bddbcf29b0b5";const o="96627c5f4b9c958bb778ceedf0b5b237";console.log("load chat bot");var a=document.createElement("script");a.setAttribute("src","https://cdn.cai.tools.sap/webclient/bootstrap.js");a.setAttribute("id","cai-webclient-custom");a.setAttribute("data-channel-id",t);a.setAttribute("data-token",o);a.setAttribute("data-expander-type","CAI");a.setAttribute("data-expander-preferences",e);document.body.appendChild(a);const n={getMemory:()=>{let e;e={mynumber:200};return{memory:e,merge:true}},onMessage:e=>{e.messages.map(e=>{if(e.attachment.type=="client_data"){var t={};t.hasNavigate=false;t.hasParameter=false;e.attachment.content.elements.map(e=>{if(e.key=="navigate"){t.hasNavigate=true;t.page=e.value}else if(e.key=="parameter"){console.log("parameter",e.value);t.hasParameter=true;t.parameter=e.value}});console.log("Message info",t);if(t.hasNavigate&&!t.hasParameter){window.location.href="index.html#/"+t.page}else if(t.hasNavigate&&t.hasParameter){if(t.page===""){window.location.href="index.html#/"+t.page+"?category="+t.parameter}else if(t.page=="carts"){window.location.href="index.html#/"+t.page}else if(t.page=="cartdetail"){window.location.href="index.html#/"+t.page+"/"+t.parameter}}}})}};window.sapcai={webclientBridge:n}},onCartClicked:function(e){var t=e.getSource(),o=this.getView();if(!this._pDialog){var n=this;this._pDialog=a.load({id:"cartSelectionDialog",name:"frontend.view.CartSelectionDialog",controller:this}).then(function(e){e.setModel(o.getModel());n._table=e.getContent()[0];return e})}this._pDialog.then(function(e){var t=this;e.attachAfterOpen(function(){var e=t.getModel("baseModel");var o=e.oData.cartInfo;if(o.ID!=""){var a=t._table.getItems();console.log("items",a);for(var n=0;n<a.length;n++){var i=a[n].getBindingContext().getObject();if(i.ID==o.ID){console.log("set selected row here");console.log("selectedItem",a[n]);t._table.setSelectedItem(a[n])}}}});e.open();console.log("table",this._table)}.bind(this))},onEditClicked:function(e){console.log("go to cart");var t=this._oStorage.get("baseModel");var o=JSON.parse(t);if(o.ID!==""){console.log("cartId",o.ID);this.getRouter().navTo("RouteCartDetailView",{cartId:o.ID})}else{alert("Please select a cart")}},onManageClicked:function(e){this.getRouter().navTo("RouteCartView")},onCartItemClicked:function(e){var t=e.getSource();console.log("source",t);var o=e.getSource().getSelectedItem();var a=o.getBindingContext().getObject();console.log("item",o);console.log("object",a);var i={ID:a.ID,cardNo:a.CardNo,total:a.total};var l=new n({cartInfo:i});this.setModel(l,"baseModel");this._oStorage.put("baseModel",JSON.stringify(i))},onDialogCancelClicked:function(e){this._pDialog.then(function(e){e.close()})},onDialogOkClicked:function(e){this._pDialog.then(function(e){e.close()})},onPressOpenBot:function(e){console.log("window",window.sap.webchat);window.sap.cai.webclient.show()},onPressCloseBot:function(e){window.sap.cai.webclient.hide()},onPressToggleBot:function(e){window.sap.cai.webclient.toggle()}})});