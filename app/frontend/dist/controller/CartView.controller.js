sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","frontend/model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/ui/Device","sap/ui/model/Sorter","sap/ui/model/odata/v4/ODataModel"],function(e,t,a,o,r,n,i,l,c){"use strict";return e.extend("frontend.controller.controller.CartView",{formatter:a,onInit:function(){this.onBaseInit();var e=this.byId("table");console.log("table",e)},showCartDetail:function(e){var t=e.getSource();var a=t.getBindingContext();var o=a.getProperty("ID");console.log("id",o);this.getRouter().navTo("RouteCartDetailView",{cartId:o})},onCreateClicked:function(e){var a=this.getView();var o=new Date;var r=o.getFullYear()+"-"+(o.getMonth()<8?"0"+o.getMonth():o.getMonth())+"-"+(o.getDate()>9?o.getDate():"0"+o.getDate());var i=new t({cartNo:r,total:0});if(!this.createCartDialog){this.createCartDialog=n.load({id:"createCartDialog",name:"frontend.view.CreateCartDialog",controller:this})}this.createCartDialog.then(function(e){console.log("dialog",e);e.setModel(i);var t=e.getModel();console.log("model",t);e.open()})},onDialogNewCartCancelClicked:function(e){this.createCartDialog.then(function(e){e.close()})},onRefresh:function(){var e=this.byId("table");e.getBinding("items").refresh()},onDialogNewCartOkClicked:function(e){var t=this;this.createCartDialog.then(function(e){console.log("oData",e.getModel().oData);var a={CardNo:e.getModel().oData.cartNo,total:e.getModel().oData.total};jQuery.ajax(t.getBaseUrl()+"/cart/Carts",{data:JSON.stringify(a),contentType:"application/json",type:"POST",success:function(a){t.onRefresh();e.close()}})})},onDeleteClicked:function(e){var t=e.getSource();console.log(t.oParent);var a=jQuery.sap.byId(t.oParent.sId).find("[name='cartId']").val();console.log("cartId",a);var o=this;jQuery.ajax(o.getBaseUrl()+"/cart/Carts("+a+")",{contentType:"application/json",type:"DELETE",success:function(){o.onRefresh()}})},onAcceptClicked:function(e){var t=e.getSource();var a=jQuery.sap.byId(t.oParent.oParent.sId).find("[name='cartId']").val();console.log("cartId",a);var o=jQuery.sap.byId(t.oParent.sId).find("[name='cartNo']").val();console.log("cartNo",o);var r={ID:a,cardNo:o};var n=this;jQuery.ajax(n.getBaseUrl()+"/cart/Carts("+a+")",{contentType:"application/json",data:JSON.stringify(r),type:"PUT",success:function(){n.onRefresh()}})}})});