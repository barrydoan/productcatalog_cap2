sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/table/RowAction","sap/ui/table/RowActionItem","sap/ui/table/RowSettings","./BaseController","sap/ui/core/Fragment"],function(t,e,i,n,a,o,s){"use strict";return o.extend("admin.controller.ProductDetail",{onInit:function(){this.cartId="";this._formFragments={};var t=this.getRouter().getRoute("RouteCartDetail");t.attachPatternMatched(this._attachPatternMatched,this);this._showFormFragment("CartDetailDisplay");var a=this.handleActionPress.bind(this);this.modes=[{key:"Delete",text:"Delete",handler:function(){var t=new i({items:[new n({type:"Delete",press:a})]});return[1,t]}},{key:"None",text:"No Actions",handler:function(){return[0,null]}}];this.getView().setModel(new e({items:this.modes}),"modes")},onNavIndicatorsToggle:function(t){var e=this.byId("tableedit");var i=t.getSource();if(i.getPressed()){e.setRowSettingsTemplate(new a({navigated:"{NavigatedState}"}))}else{e.setRowSettingsTemplate(null)}},onBehaviourModeChange:function(t){this.switchState(t.getParameter("selectedItem").getKey())},switchState:function(t){var e=this.byId("tableedit");var i=0;var n=e.getRowActionTemplate();if(n){n.destroy();n=null}for(var a=0;a<this.modes.length;a++){if(t==this.modes[a].key){var o=this.modes[a].handler();i=o[0];n=o[1];break}}e.setRowActionTemplate(n);e.setRowActionCount(i)},_attachPatternMatched:function(t){console.log("oEvent",t);this.cartId=t.getParameters().arguments.cartId;console.log("cartId",this.cartId);this.getView().bindElement(`/Carts(${this.cartId})`)},_getFormFragment:function(t){var e=this._formFragments[t],i=this.getView();if(!e){e=s.load({id:i.getId(),name:"admin.view."+t,controller:this});this._formFragments[t]=e}return e},_showFormFragment:function(t){var e=this.byId("page");var i=this;e.removeAllContent();this._getFormFragment(t).then(function(n){e.insertContent(n);var a=i.getView().getModel();a.refresh();if(t==="CartDetailChange"){i.switchState("Delete")}})},_toggleButtonsAndView:function(t){var e=this.getView();e.byId("edit").setVisible(!t);e.byId("save").setVisible(t);e.byId("cancel").setVisible(t);this._showFormFragment(t?"CartDetailChange":"CartDetailDisplay")},handleEditPress:function(){this._toggleButtonsAndView(true)},handleCancelPress:function(){this._toggleButtonsAndView(false)},handleSavePress:function(){var t=this;var e=this.getView().byId("tableedit").getRows();var i=this.getView().byId("tableedit").getModel();console.log("oItem",e);console.log("oModel",i);this.getView().getModel().submitBatch("updateCart").then(function(){t._toggleButtonsAndView(false)})},handleActionPress:function(t){var e=t.getParameter("row");var i=t.getParameter("item");var n=t.getSource();var a=n.getBindingContext();var o=a.getProperty("ID");var s=this;if(i.getType()==="Delete"){console.log("Delete row");var r=this.getView().getModel().bindList(`/Carts(${this.cartId})/Items`);r.requestContexts().then(function(t){t.forEach(function(t){if(t.getProperty("ID")===o){t.delete().then(function(){var t=s.getView().getModel();t.refresh()})}})})}}})});