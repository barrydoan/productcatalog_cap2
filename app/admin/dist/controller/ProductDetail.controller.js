sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/table/RowAction","sap/ui/table/RowActionItem","sap/ui/table/RowSettings","./BaseController","sap/ui/core/Fragment"],function(t,e,o,n,a,s,i){"use strict";return s.extend("admin.controller.ProductDetail",{onInit:function(){this.productId="";this.file=null;this._formFragments={};var t=this.getRouter().getRoute("RouteProductDetail");t.attachPatternMatched(this._attachPatternMatched,this);this._showFormFragment("ProductDetailDisplay")},_attachPatternMatched:function(t){console.log("oEvent",t);this.productId=t.getParameters().arguments.productId;console.log("productId",this.productId);this.getView().bindElement(`/Products/${this.productId}`)},_getFormFragment:function(t){var e=this._formFragments[t],o=this.getView();if(!e){e=i.load({id:o.getId(),name:"admin.view."+t,controller:this});this._formFragments[t]=e}return e},_showFormFragment:function(t){var e=this.byId("page");var o=this;e.removeAllContent();this._getFormFragment(t).then(function(t){e.insertContent(t)})},_toggleButtonsAndView:function(t){var e=this.getView();e.byId("edit").setVisible(!t);e.byId("save").setVisible(t);e.byId("cancel").setVisible(t);this._showFormFragment(t?"ProductDetailChange":"ProductDetailDisplay")},handleEditPress:function(){this._toggleButtonsAndView(true)},handleCancelPress:function(){this._toggleButtonsAndView(false)},handleSavePress:function(){var t=this;this.getView().getModel().submitBatch("updateProduct").then(function(){t._toggleButtonsAndView(false)})},onFileChange:function(t){console.log("onFileChange");this.file=t.getParameters("files").files[0]},onUploadFile:function(){if(this.file===null){alert("Please select a file")}var t=this;console.log("file",this.file);var e=new FileReader;e.onload=function(e){console.log("e",e);var o=";base64,";var n=e.currentTarget.result;var a=e.target.result.indexOf(o)+o.length;var s=e.target.result.substring(a);console.log("base64",s);console.log("vContent",n);t.updateProductImage(s)};e.readAsDataURL(this.file)},updateProductImage:function(t){var e=this.b64toBlob(t,"image/jpeg");var o=this;jQuery.ajax(this.getBaseUrl()+`/admin/Products(${this.productId})/data`,{data:e,contentType:false,processData:false,type:"PUT",success:function(){var t=o.getView().byId("productImage");t.setSrc(o.getBaseUrl()+`/admin/Products(${o.productId})/data`);console.log("oImg",t)}})},b64toBlob:function(t,e="",o=512){const n=atob(t);const a=[];for(let t=0;t<n.length;t+=o){const e=n.slice(t,t+o);const s=new Array(e.length);for(let t=0;t<e.length;t++){s[t]=e.charCodeAt(t)}const i=new Uint8Array(s);a.push(i)}const s=new Blob(a,{type:e});return s}})});